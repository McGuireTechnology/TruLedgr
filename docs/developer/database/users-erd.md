# Users Module - Entity Relationship Diagram

## Overview

This diagram shows the database schema for the **users** module, including related tables from other modules that have foreign key relationships.

### Core Tables (users module)
- `session_activities`
- `sessionanalytics`
- `user_sessions`
- `users`

### Related Tables (from other modules)
- `groups` (from groups module)
- `oauth2account` (from authentication module)
- `oauth_accounts` (from authentication module)
- `password_reset_tokens` (from authentication module)
- `passwordresettoken` (from authentication module)
- `roles` (from authorization module)
- `user_groups` (from groups module)

### Total Tables in Diagram
11 tables

## Entity Relationship Diagram

```mermaid
# Users Module ERD\n\nerDiagram\n    USERS {\n        boolean is_deleted "Is Deleted"\n        datetime deleted_at "Deleted At"\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string(100) username UK "Username"\n        string(255) email UK "Email"\n        string(255) hashed_password "Hashed Password"\n        string(32) totp_secret "Totp Secret"\n        boolean totp_enabled "Totp Enabled"\n        string(1000) backup_codes "Backup Codes"\n        string(100) first_name "First Name"\n        string(100) last_name "Last Name"\n        string(500) profile_picture_url "Profile Picture Url"\n        string(1000) bio "Bio"\n        boolean is_active "Is Active"\n        boolean is_verified "Is Verified"\n        boolean email_verified "Email Verified"\n        datetime last_login "Last Login"\n        string role_id FK "Role Id"\n        boolean is_oauth_user "Is Oauth User"\n        string(50) oauth_provider "Oauth Provider"\n        string(255) oauth_provider_id "Oauth Provider Id"\n    }\n\n    USER_SESSIONS {\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string user_id FK "User Id"\n        string(255) session_token_hash UK "Session Token Hash"\n        string(45) client_ip "Client Ip"\n        string(512) user_agent "User Agent"\n        string(255) device_fingerprint "Device Fingerprint"\n        string(255) location "Location"\n        boolean is_active "Is Active"\n        datetime last_activity "Last Activity"\n        datetime expires_at "Expires At"\n        datetime revoked_at "Revoked At"\n        string(100) revocation_reason "Revocation Reason"\n        string(50) login_method "Login Method"\n        int request_count "Request Count"\n        boolean suspicious_activity "Suspicious Activity"\n    }\n\n    SESSION_ACTIVITIES {\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string session_id FK "Session Id"\n        string user_id FK "User Id"\n        string(50) activity_type "Activity Type"\n        string(255) endpoint "Endpoint"\n        string(10) method "Method"\n        string(45) client_ip "Client Ip"\n        string(512) user_agent "User Agent"\n        string(100) request_id "Request Id"\n        int response_status "Response Status"\n        string extra_data "Extra Data"\n    }\n\n    OAUTH_ACCOUNTS {\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string user_id FK "User Id"\n        string(50) provider "Provider"\n        string(255) provider_user_id "Provider User Id"\n        string(255) provider_email "Provider Email"\n        string(255) provider_name "Provider Name"\n        string(500) provider_picture "Provider Picture"\n        string(1000) access_token "Access Token"\n        string(1000) refresh_token "Refresh Token"\n        datetime token_expires_at "Token Expires At"\n        string raw_user_data "Raw User Data"\n    }\n\n    PASSWORD_RESET_TOKENS {\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string(255) token_hash UK "Token Hash"\n        string user_id FK "User Id"\n        string(255) email "Email"\n        datetime expires_at "Expires At"\n        datetime used_at "Used At"\n        datetime revoked_at "Revoked At"\n        string(45) client_ip "Client Ip"\n        string(512) user_agent "User Agent"\n        string(50) previous_token_id "Previous Token Id"\n    }\n\n    ROLES {\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string(100) name UK "Name"\n        string(500) description "Description"\n        boolean is_system "Is System"\n        boolean is_active "Is Active"\n    }\n\n    PASSWORDRESETTOKEN {\n        string id PK "Id"\n        string token_hash "Token Hash"\n        string user_id FK "User Id"\n        string email "Email"\n        datetime created_at "Created At"\n        datetime expires_at "Expires At"\n        datetime used_at "Used At"\n        datetime revoked_at "Revoked At"\n        string client_ip "Client Ip"\n        string user_agent "User Agent"\n        int max_uses "Max Uses"\n        int use_count "Use Count"\n        string revocation_reason "Revocation Reason"\n    }\n\n    SESSIONANALYTICS {\n        int id PK "Id"\n        string session_id "Session Id"\n        string user_id FK "User Id"\n        string device_type "Device Type"\n        string browser "Browser"\n        string os "Os"\n        string ip_address "Ip Address"\n        string country "Country"\n        string city "City"\n        datetime login_time "Login Time"\n        datetime last_activity "Last Activity"\n        datetime logout_time "Logout Time"\n        int session_duration "Session Duration"\n        int page_views "Page Views"\n        int api_calls "Api Calls"\n        string last_page "Last Page"\n        string last_endpoint "Last Endpoint"\n        boolean is_suspicious "Is Suspicious"\n        int security_score "Security Score"\n        int failed_actions "Failed Actions"\n    }\n\n    OAUTH2ACCOUNT {\n        int id PK "Id"\n        string user_id FK "User Id"\n        string provider "Provider"\n        string provider_user_id "Provider User Id"\n        string email "Email"\n        string first_name "First Name"\n        string last_name "Last Name"\n        string full_name "Full Name"\n        string picture_url "Picture Url"\n        boolean is_active "Is Active"\n        boolean is_email_verified "Is Email Verified"\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        datetime last_login_at "Last Login At"\n        string access_token "Access Token"\n        string refresh_token "Refresh Token"\n        datetime token_expires_at "Token Expires At"\n        string provider_data "Provider Data"\n    }\n\n    USER_GROUPS {\n        string user_id PK FK "User Id"\n        string group_id PK FK "Group Id"\n        datetime joined_at "Joined At"\n        string joined_by "Joined By"\n        string(50) role_in_group "Role In Group"\n        boolean is_active "Is Active"\n    }\n\n    GROUPS {\n        boolean is_deleted "Is Deleted"\n        datetime deleted_at "Deleted At"\n        datetime created_at "Created At"\n        datetime updated_at "Updated At"\n        string id PK "Id"\n        string(100) name UK "Name"\n        string(100) slug UK "Slug"\n        string(1000) description "Description"\n        boolean is_public "Is Public"\n        boolean is_open "Is Open"\n        boolean is_system "Is System"\n        boolean is_active "Is Active"\n        int member_count "Member Count"\n        int max_members "Max Members"\n        string(50) group_type "Group Type"\n        string(500) tags "Tags"\n        string owner_id FK "Owner Id"\n        string created_by FK "Created By"\n        string(2000) settings "Settings"\n    }\n\n    USERS ||--o{ SESSIONANALYTICS : "user"\n    USERS ||--o{ PASSWORD_RESET_TOKENS : "user"\n    USER_SESSIONS ||--o{ SESSION_ACTIVITIES : "session"\n    USERS ||--o{ SESSION_ACTIVITIES : "user"\n    USERS ||--o{ GROUPS : "owner"\n    USERS ||--o{ OAUTH_ACCOUNTS : "user"\n    USERS ||--o{ OAUTH2ACCOUNT : "user"\n    USERS ||--o{ PASSWORDRESETTOKEN : "user"\n    USERS ||--o{ USER_GROUPS : "user"\n    GROUPS ||--o{ USER_GROUPS : "group"\n    USERS ||--o{ USER_SESSIONS : "user"\n    ROLES ||--o{ USERS : "role"
```

## Table Descriptions

### `groups` (groups module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `is_deleted` | `BOOLEAN` | NOT NULL | Is Deleted |\n| `deleted_at` | `DATETIME` |  | Deleted At |\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `name` | `VARCHAR(100)` | UNIQUE, NOT NULL | Name |\n| `slug` | `VARCHAR(100)` | UNIQUE, NOT NULL | Slug |\n| `description` | `VARCHAR(1000)` |  | Description |\n| `is_public` | `BOOLEAN` | NOT NULL | Is Public |\n| `is_open` | `BOOLEAN` | NOT NULL | Is Open |\n| `is_system` | `BOOLEAN` | NOT NULL | Is System |\n| `is_active` | `BOOLEAN` | NOT NULL | Is Active |\n| `member_count` | `INTEGER` | NOT NULL | Member Count |\n| `max_members` | `INTEGER` |  | Max Members |\n| `group_type` | `VARCHAR(50)` | NOT NULL | Group Type |\n| `tags` | `VARCHAR(500)` |  | Tags |\n| `owner_id` | `VARCHAR` | FK → users.id, NOT NULL | Owner Id |\n| `created_by` | `VARCHAR` | FK → users.id, NOT NULL | Created By |\n| `settings` | `VARCHAR(2000)` |  | Settings |\n\n### `oauth2account` (authentication module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `id` | `INTEGER` | PK, NOT NULL | Id |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `provider` | `VARCHAR` | NOT NULL | Provider |\n| `provider_user_id` | `VARCHAR` | NOT NULL | Provider User Id |\n| `email` | `VARCHAR` | NOT NULL | Email |\n| `first_name` | `VARCHAR` |  | First Name |\n| `last_name` | `VARCHAR` |  | Last Name |\n| `full_name` | `VARCHAR` |  | Full Name |\n| `picture_url` | `VARCHAR` |  | Picture Url |\n| `is_active` | `BOOLEAN` | NOT NULL | Is Active |\n| `is_email_verified` | `BOOLEAN` | NOT NULL | Is Email Verified |\n| `created_at` | `DATETIME` | NOT NULL | Created At |\n| `updated_at` | `DATETIME` | NOT NULL | Updated At |\n| `last_login_at` | `DATETIME` |  | Last Login At |\n| `access_token` | `VARCHAR` |  | Access Token |\n| `refresh_token` | `VARCHAR` |  | Refresh Token |\n| `token_expires_at` | `DATETIME` |  | Token Expires At |\n| `provider_data` | `VARCHAR` |  | Provider Data |\n\n### `oauth_accounts` (authentication module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `provider` | `VARCHAR(50)` | NOT NULL | Provider |\n| `provider_user_id` | `VARCHAR(255)` | NOT NULL | Provider User Id |\n| `provider_email` | `VARCHAR(255)` | NOT NULL | Provider Email |\n| `provider_name` | `VARCHAR(255)` |  | Provider Name |\n| `provider_picture` | `VARCHAR(500)` |  | Provider Picture |\n| `access_token` | `VARCHAR(1000)` |  | Access Token |\n| `refresh_token` | `VARCHAR(1000)` |  | Refresh Token |\n| `token_expires_at` | `DATETIME` |  | Token Expires At |\n| `raw_user_data` | `VARCHAR` |  | Raw User Data |\n\n### `password_reset_tokens` (authentication module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `token_hash` | `VARCHAR(255)` | UNIQUE, NOT NULL | Token Hash |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `email` | `VARCHAR(255)` | NOT NULL | Email |\n| `expires_at` | `DATETIME` | NOT NULL | Expires At |\n| `used_at` | `DATETIME` |  | Used At |\n| `revoked_at` | `DATETIME` |  | Revoked At |\n| `client_ip` | `VARCHAR(45)` |  | Client Ip |\n| `user_agent` | `VARCHAR(512)` |  | User Agent |\n| `previous_token_id` | `VARCHAR(50)` |  | Previous Token Id |\n\n### `passwordresettoken` (authentication module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `token_hash` | `VARCHAR` | NOT NULL | Token Hash |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `email` | `VARCHAR` | NOT NULL | Email |\n| `created_at` | `DATETIME` | NOT NULL | Created At |\n| `expires_at` | `DATETIME` | NOT NULL | Expires At |\n| `used_at` | `DATETIME` |  | Used At |\n| `revoked_at` | `DATETIME` |  | Revoked At |\n| `client_ip` | `VARCHAR` |  | Client Ip |\n| `user_agent` | `VARCHAR` |  | User Agent |\n| `max_uses` | `INTEGER` | NOT NULL | Max Uses |\n| `use_count` | `INTEGER` | NOT NULL | Use Count |\n| `revocation_reason` | `VARCHAR` |  | Revocation Reason |\n\n### `roles` (authorization module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `name` | `VARCHAR(100)` | UNIQUE, NOT NULL | Name |\n| `description` | `VARCHAR(500)` |  | Description |\n| `is_system` | `BOOLEAN` | NOT NULL | Is System |\n| `is_active` | `BOOLEAN` | NOT NULL | Is Active |\n\n### `session_activities`\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `session_id` | `VARCHAR` | FK → user_sessions.id, NOT NULL | Session Id |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `activity_type` | `VARCHAR(50)` | NOT NULL | Activity Type |\n| `endpoint` | `VARCHAR(255)` |  | Endpoint |\n| `method` | `VARCHAR(10)` |  | Method |\n| `client_ip` | `VARCHAR(45)` | NOT NULL | Client Ip |\n| `user_agent` | `VARCHAR(512)` |  | User Agent |\n| `request_id` | `VARCHAR(100)` |  | Request Id |\n| `response_status` | `INTEGER` |  | Response Status |\n| `extra_data` | `VARCHAR` |  | Extra Data |\n\n### `sessionanalytics`\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `id` | `INTEGER` | PK, NOT NULL | Id |\n| `session_id` | `VARCHAR` | NOT NULL | Session Id |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `device_type` | `VARCHAR` |  | Device Type |\n| `browser` | `VARCHAR` |  | Browser |\n| `os` | `VARCHAR` |  | Os |\n| `ip_address` | `VARCHAR` |  | Ip Address |\n| `country` | `VARCHAR` |  | Country |\n| `city` | `VARCHAR` |  | City |\n| `login_time` | `DATETIME` | NOT NULL | Login Time |\n| `last_activity` | `DATETIME` | NOT NULL | Last Activity |\n| `logout_time` | `DATETIME` |  | Logout Time |\n| `session_duration` | `INTEGER` |  | Session Duration |\n| `page_views` | `INTEGER` | NOT NULL | Page Views |\n| `api_calls` | `INTEGER` | NOT NULL | Api Calls |\n| `last_page` | `VARCHAR` |  | Last Page |\n| `last_endpoint` | `VARCHAR` |  | Last Endpoint |\n| `is_suspicious` | `BOOLEAN` | NOT NULL | Is Suspicious |\n| `security_score` | `INTEGER` | NOT NULL | Security Score |\n| `failed_actions` | `INTEGER` | NOT NULL | Failed Actions |\n\n### `user_groups` (groups module)\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `user_id` | `VARCHAR` | PK, FK → users.id, NOT NULL | User Id |\n| `group_id` | `VARCHAR` | PK, FK → groups.id, NOT NULL | Group Id |\n| `joined_at` | `DATETIME` | NOT NULL | Joined At |\n| `joined_by` | `VARCHAR` |  | Joined By |\n| `role_in_group` | `VARCHAR(50)` |  | Role In Group |\n| `is_active` | `BOOLEAN` | NOT NULL | Is Active |\n\n### `user_sessions`\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `user_id` | `VARCHAR` | FK → users.id, NOT NULL | User Id |\n| `session_token_hash` | `VARCHAR(255)` | UNIQUE, NOT NULL | Session Token Hash |\n| `client_ip` | `VARCHAR(45)` | NOT NULL | Client Ip |\n| `user_agent` | `VARCHAR(512)` |  | User Agent |\n| `device_fingerprint` | `VARCHAR(255)` |  | Device Fingerprint |\n| `location` | `VARCHAR(255)` |  | Location |\n| `is_active` | `BOOLEAN` | NOT NULL | Is Active |\n| `last_activity` | `DATETIME` | NOT NULL | Last Activity |\n| `expires_at` | `DATETIME` | NOT NULL | Expires At |\n| `revoked_at` | `DATETIME` |  | Revoked At |\n| `revocation_reason` | `VARCHAR(100)` |  | Revocation Reason |\n| `login_method` | `VARCHAR(50)` |  | Login Method |\n| `request_count` | `INTEGER` | NOT NULL | Request Count |\n| `suspicious_activity` | `BOOLEAN` | NOT NULL | Suspicious Activity |\n\n### `users`\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| `is_deleted` | `BOOLEAN` | NOT NULL | Is Deleted |\n| `deleted_at` | `DATETIME` |  | Deleted At |\n| `created_at` | `DATETIME` |  | Created At |\n| `updated_at` | `DATETIME` |  | Updated At |\n| `id` | `VARCHAR` | PK, NOT NULL | Id |\n| `username` | `VARCHAR(100)` | UNIQUE, NOT NULL | Username |\n| `email` | `VARCHAR(255)` | UNIQUE, NOT NULL | Email |\n| `hashed_password` | `VARCHAR(255)` |  | Hashed Password |\n| `totp_secret` | `VARCHAR(32)` |  | Totp Secret |\n| `totp_enabled` | `BOOLEAN` | NOT NULL | Totp Enabled |\n| `backup_codes` | `VARCHAR(1000)` |  | Backup Codes |\n| `first_name` | `VARCHAR(100)` |  | First Name |\n| `last_name` | `VARCHAR(100)` |  | Last Name |\n| `profile_picture_url` | `VARCHAR(500)` |  | Profile Picture Url |\n| `bio` | `VARCHAR(1000)` |  | Bio |\n| `is_active` | `BOOLEAN` | NOT NULL | Is Active |\n| `is_verified` | `BOOLEAN` | NOT NULL | Is Verified |\n| `email_verified` | `BOOLEAN` | NOT NULL | Email Verified |\n| `last_login` | `DATETIME` |  | Last Login |\n| `role_id` | `VARCHAR` | FK → roles.id | Role Id |\n| `is_oauth_user` | `BOOLEAN` | NOT NULL | Is Oauth User |\n| `oauth_provider` | `VARCHAR(50)` |  | Oauth Provider |\n| `oauth_provider_id` | `VARCHAR(255)` |  | Oauth Provider Id |\n\n## Relationships\n\n- `groups.owner_id` → `users.id`\n- `groups.created_by` → `users.id`\n- `oauth2account.user_id` → `users.id`\n- `oauth_accounts.user_id` → `users.id`\n- `password_reset_tokens.user_id` → `users.id`\n- `passwordresettoken.user_id` → `users.id`\n- `session_activities.session_id` → `user_sessions.id`\n- `session_activities.user_id` → `users.id`\n- `sessionanalytics.user_id` → `users.id`\n- `user_groups.user_id` → `users.id`\n- `user_groups.group_id` → `groups.id`\n- `user_sessions.user_id` → `users.id`\n- `users.role_id` → `roles.id`\n